name: pr

on:
    pull_request:
      branches:
        - main
jobs:
    docker-build-container:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout repository
              uses: actions/checkout@v4
              with:
                fetch-depth: "0"
            - name: Build Docker container
              run: |
                export GIT_VERSION=${GIT_VERSION:=$(git describe --always --tags --long --dirty | sed -e 's/\-0//' -e 's/\-g.......//')}

                echo "[INFO] GIT_VERSION: $GIT_VERSION"

                echo "[INFO] docker build \
                --tag ${GITHUB_REPOSITORY} \
                --tag ${GITHUB_REPOSITORY}:${GIT_VERSION} \
                ."
                docker build \
                    --tag ${GITHUB_REPOSITORY} \
                    --tag ${GITHUB_REPOSITORY}:${GIT_VERSION} \
                    .
            - name: test
              run: |
                echo "[INFO] docker run ${GITHUB_REPOSITORY}:${GIT_VERSION}"
                docker run ${GITHUB_REPOSITORY}:${GIT_VERSION}